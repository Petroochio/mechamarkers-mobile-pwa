{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/aruco/cv.js","webpack:///./src/aruco/index.js","webpack:///./src/index.js"],"names":["CV","Image","width","height","data","grayscale","imageSrc","imageDst","src","dst","len","length","i","j","threshold","tab","adaptiveThreshold","kernelSize","stackBoxBlur","otsu","hist","sum","sumB","wB","wF","max","mu","between","stackBoxBlurMult","stackBoxBlurShift","BlurStack","color","next","heightMinus1","widthMinus1","size","radius","mult","shift","stack","stackStart","pos","start","p","x","y","gaussianBlur","imageMean","kernel","gaussianKernel","gaussianBlurFilter","horizontal","limit","cur","value","k","center","sigma","scale2X","Math","exp","findContours","binary","contours","deltas","pix","nbd","outer","hole","binaryBorder","neighborhoodDeltas","push","borderFollowing","point","contour","pos1","pos3","pos4","s","s_end","s_prev","neighborhood","concat","approxPolyDP","epsilon","slice","start_index","end_index","right_slice","poly","pt","start_pt","end_pt","dist","max_dist","le_eps","dx","dy","pop","abs","warp","warpSize","sx1","sx2","dx1","dx2","sy1","sy2","dy1","dy2","p1","p2","p3","p4","m","r","t","u","v","w","getPerspectiveTransform","rq","square2quad","sq","px","py","den","isContourConvex","orientation","convex","cur_pt","prev_pt","dxdy0","dydx0","dx0","dy0","perimeter","sqrt","minEdgeLength","min","Infinity","d","countNonZero","square","span","nz","posSrc","posDst","AR","cameraParams","MIN_MARKER_DISTANCE","MIN_MARKER_PERIMETER","MAX_MARKER_PERIMETER","SIZE_AFTER_PERSPECTIVE_REMOVAL","setCameraParams","params","xIntercept","m0","m1","p0","lineY","Marker","id","corners","Detector","grey","thres","homography","polys","candidates","prototype","detect","image","findCandidates","clockwiseCorners","notTooNear","findMarkers","minSize","maxSize","minLength","swap","minDist","tooNear","markers","candidate","marker","getMarker","minZero","bits","rotations","distances","pair","inc","hammingDistance","first","second","rotate","mat2id","rotate2","ids","minSum","rotation","DEFAULT_DEFECTION_PARAMS","ArucoDetector","constructor","detectionParams","newParams","updateParams","canStreamMarkers","MESSAGE_TYPES","SET_HOST","MARKER_DATA","VIDEO_DATA","SET_CAMERA_PARAMS","CONNECT_TO_HOST","peerID","shouldStreamVideo","socket","WebSocket","canStream","URL","document","location","searchParams","hostID","get","observerID","fpsCounter","addEventListener","event","msg","type","send","JSON","stringify","parse","video","canvas","context","imageData","detector","aspectRatio","overlay","overlayCtx","onLoad","getElementById","getContext","querySelector","window","innerWidth","innerHeight","navigator","mediaDevices","undefined","getUserMedia","constraints","webkitGetUserMedia","mozGetUserMedia","Promise","reject","Error","resolve","call","facingMode","then","stream","srcObject","getVideoTracks","getSettings","createObjectURL","catch","err","console","log","name","message","aruco","requestAnimationFrame","update","prevTime","Date","now","FRAME_CAP","frameCounter","currentTime","dt","innerHTML","floor","videoWidth","videoHeight","readyState","HAVE_ENOUGH_DATA","drawImage","getImageData","clearRect","drawCorners","ctx","lineWidth","forEach","strokeStyle","beginPath","c","moveTo","c2","I","lineTo","stroke","closePath","strokeRect","drawId","corner","strokeText","onload","serviceWorker","register"],"mappings":"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","file":"app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","/*\nCopyright (c) 2011 Juan Mellado\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n*/\n\n/*\nReferences:\n- \"OpenCV: Open Computer Vision Library\"\n  http://sourceforge.net/projects/opencvlibrary/\n- \"Stack Blur: Fast But Goodlooking\"\n  http://incubator.quasimondo.com/processing/fast_blur_deluxe.php\n*/\n\nvar CV = CV || {};\n\nCV.Image = function(width, height, data){\n  this.width = width || 0;\n  this.height = height || 0;\n  this.data = data || [];\n};\n\nCV.grayscale = function(imageSrc, imageDst){\n  var src = imageSrc.data, dst = imageDst.data, len = src.length,\n      i = 0, j = 0;\n\n  for (; i < len; i += 4){\n    dst[j ++] =\n      (src[i] * 0.299 + src[i + 1] * 0.587 + src[i + 2] * 0.114 + 0.5) & 0xff;\n  }\n  \n  imageDst.width = imageSrc.width;\n  imageDst.height = imageSrc.height;\n  \n  return imageDst;\n};\n\nCV.threshold = function(imageSrc, imageDst, threshold){\n  var src = imageSrc.data, dst = imageDst.data,\n      len = src.length, tab = [], i;\n\n  for (i = 0; i < 256; ++ i){\n    tab[i] = i <= threshold? 0: 255;\n  }\n\n  for (i = 0; i < len; ++ i){\n    dst[i] = tab[ src[i] ];\n  }\n\n  imageDst.width = imageSrc.width;\n  imageDst.height = imageSrc.height;\n\n  return imageDst;\n};\n\nCV.adaptiveThreshold = function(imageSrc, imageDst, kernelSize, threshold){\n  var src = imageSrc.data, dst = imageDst.data, len = src.length, tab = [], i;\n\n  CV.stackBoxBlur(imageSrc, imageDst, kernelSize);\n\n  for (i = 0; i < 768; ++ i){\n    tab[i] = (i - 255 <= -threshold)? 255: 0;\n  }\n\n  for (i = 0; i < len; ++ i){\n    dst[i] = tab[ src[i] - dst[i] + 255 ];\n  }\n\n  imageDst.width = imageSrc.width;\n  imageDst.height = imageSrc.height;\n  \n  return imageDst;\n};\n\nCV.otsu = function(imageSrc){\n  var src = imageSrc.data, len = src.length, hist = [],\n      threshold = 0, sum = 0, sumB = 0, wB = 0, wF = 0, max = 0,\n      mu, between, i;\n\n  for (i = 0; i < 256; ++ i){\n    hist[i] = 0;\n  }\n  \n  for (i = 0; i < len; ++ i){\n    hist[ src[i] ] ++;\n  }\n\n  for (i = 0; i < 256; ++ i){\n    sum += hist[i] * i;\n  }\n\n  for (i = 0; i < 256; ++ i){\n    wB += hist[i];\n    if (0 !== wB){\n    \n      wF = len - wB;\n      if (0 === wF){\n        break;\n      }\n\n      sumB += hist[i] * i;\n      \n      mu = (sumB / wB) - ( (sum - sumB) / wF );\n\n      between = wB * wF * mu * mu;\n      \n      if (between > max){\n        max = between;\n        threshold = i;\n      }\n    }\n  }\n\n  return threshold;\n};\n\nCV.stackBoxBlurMult =\n  [1, 171, 205, 293, 57, 373, 79, 137, 241, 27, 391, 357, 41, 19, 283, 265];\n\nCV.stackBoxBlurShift =\n  [0, 9, 10, 11, 9, 12, 10, 11, 12, 9, 13, 13, 10, 9, 13, 13];\n\nCV.BlurStack = function(){\n  this.color = 0;\n  this.next = null;\n};\n\nCV.stackBoxBlur = function(imageSrc, imageDst, kernelSize){\n  var src = imageSrc.data, dst = imageDst.data,\n      height = imageSrc.height, width = imageSrc.width,\n      heightMinus1 = height - 1, widthMinus1 = width - 1,\n      size = kernelSize + kernelSize + 1, radius = kernelSize + 1,\n      mult = CV.stackBoxBlurMult[kernelSize],\n      shift = CV.stackBoxBlurShift[kernelSize],\n      stack, stackStart, color, sum, pos, start, p, x, y, i;\n\n  stack = stackStart = new CV.BlurStack();\n  for (i = 1; i < size; ++ i){\n    stack = stack.next = new CV.BlurStack();\n  }\n  stack.next = stackStart;\n\n  pos = 0;\n\n  for (y = 0; y < height; ++ y){\n    start = pos;\n    \n    color = src[pos];\n    sum = radius * color;\n    \n    stack = stackStart;\n    for (i = 0; i < radius; ++ i){\n      stack.color = color;\n      stack = stack.next;\n    }\n    for (i = 1; i < radius; ++ i){\n      stack.color = src[pos + i];\n      sum += stack.color;\n      stack = stack.next;\n    }\n  \n    stack = stackStart;\n    for (x = 0; x < width; ++ x){\n      dst[pos ++] = (sum * mult) >>> shift;\n      \n      p = x + radius;\n      p = start + (p < widthMinus1? p: widthMinus1);\n      sum -= stack.color - src[p];\n      \n      stack.color = src[p];\n      stack = stack.next;\n    }\n  }\n\n  for (x = 0; x < width; ++ x){\n    pos = x;\n    start = pos + width;\n    \n    color = dst[pos];\n    sum = radius * color;\n    \n    stack = stackStart;\n    for (i = 0; i < radius; ++ i){\n      stack.color = color;\n      stack = stack.next;\n    }\n    for (i = 1; i < radius; ++ i){\n      stack.color = dst[start];\n      sum += stack.color;\n      stack = stack.next;\n      \n      start += width;\n    }\n    \n    stack = stackStart;\n    for (y = 0; y < height; ++ y){\n      dst[pos] = (sum * mult) >>> shift;\n      \n      p = y + radius;\n      p = x + ( (p < heightMinus1? p: heightMinus1) * width );\n      sum -= stack.color - dst[p];\n      \n      stack.color = dst[p];\n      stack = stack.next;\n      \n      pos += width;\n    }\n  }\n\n  return imageDst;\n};\n\nCV.gaussianBlur = function(imageSrc, imageDst, imageMean, kernelSize){\n  var kernel = CV.gaussianKernel(kernelSize);\n\n  imageDst.width = imageSrc.width;\n  imageDst.height = imageSrc.height;\n  \n  imageMean.width = imageSrc.width;\n  imageMean.height = imageSrc.height;\n\n  CV.gaussianBlurFilter(imageSrc, imageMean, kernel, true);\n  CV.gaussianBlurFilter(imageMean, imageDst, kernel, false);\n\n  return imageDst;\n};\n\nCV.gaussianBlurFilter = function(imageSrc, imageDst, kernel, horizontal){\n  var src = imageSrc.data, dst = imageDst.data,\n      height = imageSrc.height, width = imageSrc.width,\n      pos = 0, limit = kernel.length >> 1,\n      cur, value, i, j, k;\n      \n  for (i = 0; i < height; ++ i){\n    \n    for (j = 0; j < width; ++ j){\n      value = 0.0;\n    \n      for (k = -limit; k <= limit; ++ k){\n\n        if (horizontal){\n          cur = pos + k;\n          if (j + k < 0){\n            cur = pos;\n          }\n          else if (j + k >= width){\n            cur = pos;\n          }\n        }else{\n          cur = pos + (k * width);\n          if (i + k < 0){\n            cur = pos;\n          }\n          else if (i + k >= height){\n            cur = pos;\n          }\n        }\n\n        value += kernel[limit + k] * src[cur];\n      }\n    \n      dst[pos ++] = horizontal? value: (value + 0.5) & 0xff;\n    }\n  }\n\n  return imageDst;\n};\n\nCV.gaussianKernel = function(kernelSize){\n  var tab =\n    [ [1],\n      [0.25, 0.5, 0.25],\n      [0.0625, 0.25, 0.375, 0.25, 0.0625],\n      [0.03125, 0.109375, 0.21875, 0.28125, 0.21875, 0.109375, 0.03125] ],\n    kernel = [], center, sigma, scale2X, sum, x, i;\n\n  if ( (kernelSize <= 7) && (kernelSize % 2 === 1) ){\n    kernel = tab[kernelSize >> 1];\n  }else{\n    center = (kernelSize - 1.0) * 0.5;\n    sigma = 0.8 + (0.3 * (center - 1.0) );\n    scale2X = -0.5 / (sigma * sigma);\n    sum = 0.0;\n    for (i = 0; i < kernelSize; ++ i){\n      x = i - center;\n      sum += kernel[i] = Math.exp(scale2X * x * x);\n    }\n    sum = 1 / sum;\n    for (i = 0; i < kernelSize; ++ i){\n      kernel[i] *= sum;\n    }  \n  }\n\n  return kernel;\n};\n\nCV.findContours = function(imageSrc, binary){\n  var width = imageSrc.width, height = imageSrc.height, contours = [],\n      src, deltas, pos, pix, nbd, outer, hole, i, j;\n  \n  src = CV.binaryBorder(imageSrc, binary);\n\n  deltas = CV.neighborhoodDeltas(width + 2);\n\n  pos = width + 3;\n  nbd = 1;\n\n  for (i = 0; i < height; ++ i, pos += 2){\n  \n    for (j = 0; j < width; ++ j, ++ pos){\n      pix = src[pos];\n\n      if (0 !== pix){\n        outer = hole = false;\n\n        if (1 === pix && 0 === src[pos - 1]){\n          outer = true;\n        }\n        else if (pix >= 1 && 0 === src[pos + 1]){\n          hole = true;\n        }\n\n        if (outer || hole){\n          ++ nbd;\n          \n          contours.push( CV.borderFollowing(src, pos, nbd, {x: j, y: i}, hole, deltas) );\n        }\n      }\n    }\n  }  \n\n  return contours;\n};\n\nCV.borderFollowing = function(src, pos, nbd, point, hole, deltas){\n  var contour = [], pos1, pos3, pos4, s, s_end, s_prev;\n\n  contour.hole = hole;\n      \n  s = s_end = hole? 0: 4;\n  do{\n    s = (s - 1) & 7;\n    pos1 = pos + deltas[s];\n    if (src[pos1] !== 0){\n      break;\n    }\n  }while(s !== s_end);\n  \n  if (s === s_end){\n    src[pos] = -nbd;\n    contour.push( {x: point.x, y: point.y} );\n\n  }else{\n    pos3 = pos;\n    s_prev = s ^ 4;\n\n    while(true){\n      s_end = s;\n    \n      do{\n        pos4 = pos3 + deltas[++ s];\n      }while(src[pos4] === 0);\n      \n      s &= 7;\n      \n      if ( ( (s - 1) >>> 0) < (s_end >>> 0) ){\n        src[pos3] = -nbd;\n      }\n      else if (src[pos3] === 1){\n        src[pos3] = nbd;\n      }\n\n      contour.push( {x: point.x, y: point.y} );\n      \n      s_prev = s;\n\n      point.x += CV.neighborhood[s][0];\n      point.y += CV.neighborhood[s][1];\n\n      if ( (pos4 === pos) && (pos3 === pos1) ){\n        break;\n      }\n      \n      pos3 = pos4;\n      s = (s + 4) & 7;\n    }\n  }\n\n  return contour;\n};\n\nCV.neighborhood = \n  [ [1, 0], [1, -1], [0, -1], [-1, -1], [-1, 0], [-1, 1], [0, 1], [1, 1] ];\n\nCV.neighborhoodDeltas = function(width){\n  var deltas = [], len = CV.neighborhood.length, i = 0;\n  \n  for (; i < len; ++ i){\n    deltas[i] = CV.neighborhood[i][0] + (CV.neighborhood[i][1] * width);\n  }\n  \n  return deltas.concat(deltas);\n};\n\nCV.approxPolyDP = function(contour, epsilon){\n  var slice = {start_index: 0, end_index: 0},\n      right_slice = {start_index: 0, end_index: 0},\n      poly = [], stack = [], len = contour.length,\n      pt, start_pt, end_pt, dist, max_dist, le_eps,\n      dx, dy, i, j, k;\n  \n  epsilon *= epsilon;\n  \n  k = 0;\n  \n  for (i = 0; i < 3; ++ i){\n    max_dist = 0;\n    \n    k = (k + right_slice.start_index) % len;\n    start_pt = contour[k];\n    if (++ k === len) {k = 0;}\n  \n    for (j = 1; j < len; ++ j){\n      pt = contour[k];\n      if (++ k === len) {k = 0;}\n    \n      dx = pt.x - start_pt.x;\n      dy = pt.y - start_pt.y;\n      dist = dx * dx + dy * dy;\n\n      if (dist > max_dist){\n        max_dist = dist;\n        right_slice.start_index = j;\n      }\n    }\n  }\n\n  if (max_dist <= epsilon){\n    poly.push( {x: start_pt.x, y: start_pt.y} );\n\n  }else{\n    slice.start_index = k;\n    slice.end_index = (right_slice.start_index += slice.start_index);\n  \n    right_slice.start_index -= right_slice.start_index >= len? len: 0;\n    right_slice.end_index = slice.start_index;\n    if (right_slice.end_index < right_slice.start_index){\n      right_slice.end_index += len;\n    }\n    \n    stack.push( {start_index: right_slice.start_index, end_index: right_slice.end_index} );\n    stack.push( {start_index: slice.start_index, end_index: slice.end_index} );\n  }\n\n  while(stack.length !== 0){\n    slice = stack.pop();\n    \n    end_pt = contour[slice.end_index % len];\n    start_pt = contour[k = slice.start_index % len];\n    if (++ k === len) {k = 0;}\n    \n    if (slice.end_index <= slice.start_index + 1){\n      le_eps = true;\n    \n    }else{\n      max_dist = 0;\n\n      dx = end_pt.x - start_pt.x;\n      dy = end_pt.y - start_pt.y;\n      \n      for (i = slice.start_index + 1; i < slice.end_index; ++ i){\n        pt = contour[k];\n        if (++ k === len) {k = 0;}\n        \n        dist = Math.abs( (pt.y - start_pt.y) * dx - (pt.x - start_pt.x) * dy);\n\n        if (dist > max_dist){\n          max_dist = dist;\n          right_slice.start_index = i;\n        }\n      }\n      \n      le_eps = max_dist * max_dist <= epsilon * (dx * dx + dy * dy);\n    }\n    \n    if (le_eps){\n      poly.push( {x: start_pt.x, y: start_pt.y} );\n\n    }else{\n      right_slice.end_index = slice.end_index;\n      slice.end_index = right_slice.start_index;\n\n      stack.push( {start_index: right_slice.start_index, end_index: right_slice.end_index} );\n      stack.push( {start_index: slice.start_index, end_index: slice.end_index} );\n    }\n  }\n  \n  return poly;\n};\n\nCV.warp = function(imageSrc, imageDst, contour, warpSize){\n  var src = imageSrc.data, dst = imageDst.data,\n      width = imageSrc.width, height = imageSrc.height,\n      pos = 0,\n      sx1, sx2, dx1, dx2, sy1, sy2, dy1, dy2, p1, p2, p3, p4,\n      m, r, s, t, u, v, w, x, y, i, j;\n  \n  m = CV.getPerspectiveTransform(contour, warpSize - 1);\n\n  r = m[8];\n  s = m[2];\n  t = m[5];\n  \n  for (i = 0; i < warpSize; ++ i){\n    r += m[7];\n    s += m[1];\n    t += m[4];\n\n    u = r;\n    v = s;\n    w = t;\n    \n    for (j = 0; j < warpSize; ++ j){\n      u += m[6];\n      v += m[0];\n      w += m[3];\n\n      x = v / u;\n      y = w / u;\n\n      sx1 = x >>> 0;\n      sx2 = (sx1 === width - 1)? sx1: sx1 + 1;\n      dx1 = x - sx1;\n      dx2 = 1.0 - dx1;\n\n      sy1 = y >>> 0;\n      sy2 = (sy1 === height - 1)? sy1: sy1 + 1;\n      dy1 = y - sy1;\n      dy2 = 1.0 - dy1;\n\n      p1 = p2 = sy1 * width;\n      p3 = p4 = sy2 * width;\n\n      dst[pos ++] = \n        (dy2 * (dx2 * src[p1 + sx1] + dx1 * src[p2 + sx2]) +\n         dy1 * (dx2 * src[p3 + sx1] + dx1 * src[p4 + sx2]) ) & 0xff;\n\n    }\n  }\n\n  imageDst.width = warpSize;\n  imageDst.height = warpSize;\n\n  return imageDst;\n};\n\nCV.getPerspectiveTransform = function(src, size){\n  var rq = CV.square2quad(src);\n  \n  rq[0] /= size;\n  rq[1] /= size;\n  rq[3] /= size;\n  rq[4] /= size;\n  rq[6] /= size;\n  rq[7] /= size;\n  \n  return rq;\n};\n\nCV.square2quad = function(src){\n  var sq = [], px, py, dx1, dx2, dy1, dy2, den;\n  \n  px = src[0].x - src[1].x + src[2].x - src[3].x;\n  py = src[0].y - src[1].y + src[2].y - src[3].y;\n  \n  if (0 === px && 0 === py){\n    sq[0] = src[1].x - src[0].x;\n    sq[1] = src[2].x - src[1].x;\n    sq[2] = src[0].x;\n    sq[3] = src[1].y - src[0].y;\n    sq[4] = src[2].y - src[1].y;\n    sq[5] = src[0].y;\n    sq[6] = 0;\n    sq[7] = 0;\n    sq[8] = 1;\n\n  }else{\n    dx1 = src[1].x - src[2].x;\n    dx2 = src[3].x - src[2].x;\n    dy1 = src[1].y - src[2].y;\n    dy2 = src[3].y - src[2].y;\n    den = dx1 * dy2 - dx2 * dy1;\n  \n    sq[6] = (px * dy2 - dx2 * py) / den;\n    sq[7] = (dx1 * py - px * dy1) / den;\n    sq[8] = 1;\n    sq[0] = src[1].x - src[0].x + sq[6] * src[1].x;\n    sq[1] = src[3].x - src[0].x + sq[7] * src[3].x;\n    sq[2] = src[0].x;\n    sq[3] = src[1].y - src[0].y + sq[6] * src[1].y;\n    sq[4] = src[3].y - src[0].y + sq[7] * src[3].y;\n    sq[5] = src[0].y;\n  }\n\n  return sq;\n};\n\nCV.isContourConvex = function(contour){\n  var orientation = 0, convex = true,\n      len = contour.length, i = 0, j = 0,\n      cur_pt, prev_pt, dxdy0, dydx0, dx0, dy0, dx, dy;\n\n  prev_pt = contour[len - 1];\n  cur_pt = contour[0];\n\n  dx0 = cur_pt.x - prev_pt.x;\n  dy0 = cur_pt.y - prev_pt.y;\n\n  for (; i < len; ++ i){\n    if (++ j === len) {j = 0;}\n\n    prev_pt = cur_pt;\n    cur_pt = contour[j];\n\n    dx = cur_pt.x - prev_pt.x;\n    dy = cur_pt.y - prev_pt.y;\n    dxdy0 = dx * dy0;\n    dydx0 = dy * dx0;\n\n    orientation |= dydx0 > dxdy0? 1: (dydx0 < dxdy0? 2: 3);\n\n    if (3 === orientation){\n        convex = false;\n        break;\n    }\n\n    dx0 = dx;\n    dy0 = dy;\n  }\n\n  return convex;\n};\n\nCV.perimeter = function(poly){\n  var len = poly.length, i = 0, j = len - 1,\n      p = 0.0, dx, dy;\n\n  for (; i < len; j = i ++){\n    dx = poly[i].x - poly[j].x;\n    dy = poly[i].y - poly[j].y;\n    \n    p += Math.sqrt(dx * dx + dy * dy) ;\n  }\n\n  return p;\n};\n\nCV.minEdgeLength = function(poly){\n  var len = poly.length, i = 0, j = len - 1, \n      min = Infinity, d, dx, dy;\n\n  for (; i < len; j = i ++){\n    dx = poly[i].x - poly[j].x;\n    dy = poly[i].y - poly[j].y;\n\n    d = dx * dx + dy * dy;\n\n    if (d < min){\n      min = d;\n    }\n  }\n  \n  return Math.sqrt(min);\n};\n\nCV.countNonZero = function(imageSrc, square){\n  var src = imageSrc.data, height = square.height, width = square.width,\n      pos = square.x + (square.y * imageSrc.width),\n      span = imageSrc.width - width,\n      nz = 0, i, j;\n  \n  for (i = 0; i < height; ++ i){\n\n    for (j = 0; j < width; ++ j){\n    \n      if ( 0 !== src[pos ++] ){\n        ++ nz;\n      }\n    }\n    \n    pos += span;\n  }\n\n  return nz;\n};\n\nCV.binaryBorder = function(imageSrc, dst){\n  var src = imageSrc.data, height = imageSrc.height, width = imageSrc.width,\n      posSrc = 0, posDst = 0, i, j;\n\n  for (j = -2; j < width; ++ j){\n    dst[posDst ++] = 0;\n  }\n\n  for (i = 0; i < height; ++ i){\n    dst[posDst ++] = 0;\n    \n    for (j = 0; j < width; ++ j){\n      dst[posDst ++] = (0 === src[posSrc ++]? 0: 1);\n    }\n    \n    dst[posDst ++] = 0;\n  }\n\n  for (j = -2; j < width; ++ j){\n    dst[posDst ++] = 0;\n  }\n  \n  return dst;\n};\n\nexport default CV;\n","/*\nCopyright (c) 2011 Juan Mellado\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n*/\n\n/*\nReferences:\n- \"ArUco: a minimal library for Augmented Reality applications based on OpenCv\"\n  http://www.uco.es/investiga/grupos/ava/node/26\n*/\nimport CV from './cv';\n\n\nconst AR ={};\nlet cameraParams = {\n  MIN_MARKER_DISTANCE: 10,\n  MIN_MARKER_PERIMETER: 0.2,\n  MAX_MARKER_PERIMETER: 0.8,\n  SIZE_AFTER_PERSPECTIVE_REMOVAL: 49,\n}\n\nAR.setCameraParams = (params) => {\n  cameraParams = {\n    ...cameraParams,\n    ...params,\n  };\n}\n\nfunction xIntercept(m0, m1, p0, p1) {\n  return (p0.y - p1.y + (m1 * p1.x) - (m0 * p0.x)) / (m1 - m0);\n}\n\n// find y for given x of a line with slope m that intersects with point p\nfunction lineY(p, m, x) {\n  return m * (x - p.x) + p.y;\n}\n\nAR.Marker = (id, corners) => {\n  const m0 = (corners[0].y - corners[2].y) / (corners[0].x - corners[2].x);\n  const m1 = (corners[1].y - corners[3].y) / (corners[1].x - corners[3].x);\n  const center = { x: 0, y: 0 };\n\n  center.x = xIntercept(m0, m1, corners[0], corners[1]);\n  center.y = lineY(corners[0], m0, center.x);\n\n  return {\n    id,\n    corners,\n    center,\n  }\n};\n\n\n\nAR.Detector = function(){\n  this.grey = new CV.Image();\n  this.thres = new CV.Image();\n  this.homography = new CV.Image();\n  this.binary = [];\n  this.contours = [];\n  this.polys = [];\n  this.candidates = [];\n};\n\nAR.Detector.prototype.detect = function(image){\n  CV.grayscale(image, this.grey);\n  CV.adaptiveThreshold(this.grey, this.thres, 1, 7);\n  \n  this.contours = CV.findContours(this.thres, this.binary);\n\n  this.candidates = this.findCandidates(this.contours, image.width * cameraParams.MIN_MARKER_PERIMETER, image.width * cameraParams.MAX_MARKER_PERIMETER, 0.05, 10);\n  this.candidates = this.clockwiseCorners(this.candidates);\n  this.candidates = this.notTooNear(this.candidates, cameraParams.MIN_MARKER_DISTANCE);\n\n  return this.findMarkers(this.grey, this.candidates, cameraParams.SIZE_AFTER_PERSPECTIVE_REMOVAL);\n};\n\nAR.Detector.prototype.findCandidates = function(contours, minSize, maxSize, epsilon, minLength){\n  var candidates = [], len = contours.length, contour, poly, i;\n\n  this.polys = [];\n  \n  for (i = 0; i < len; ++ i){\n    contour = contours[i];\n\n    if (contour.length >= minSize && contour.length <= maxSize){\n      poly = CV.approxPolyDP(contour, contour.length * epsilon);\n\n      this.polys.push(poly);\n\n      if ( (4 === poly.length) && ( CV.isContourConvex(poly) ) ){\n\n        if ( CV.minEdgeLength(poly) >= minLength){\n          candidates.push(poly);\n        }\n      }\n    }\n  }\n\n  return candidates;\n};\n\nAR.Detector.prototype.clockwiseCorners = function(candidates){\n  var len = candidates.length, dx1, dx2, dy1, dy2, swap, i;\n\n  for (i = 0; i < len; ++ i){\n    dx1 = candidates[i][1].x - candidates[i][0].x;\n    dy1 = candidates[i][1].y - candidates[i][0].y;\n    dx2 = candidates[i][2].x - candidates[i][0].x;\n    dy2 = candidates[i][2].y - candidates[i][0].y;\n\n    if ( (dx1 * dy2 - dy1 * dx2) < 0){\n      swap = candidates[i][1];\n      candidates[i][1] = candidates[i][3];\n      candidates[i][3] = swap;\n    }\n  }\n\n  return candidates;\n};\n\nAR.Detector.prototype.notTooNear = function(candidates, minDist){\n  var notTooNear = [], len = candidates.length, dist, dx, dy, i, j, k;\n\n  for (i = 0; i < len; ++ i){\n  \n    for (j = i + 1; j < len; ++ j){\n      dist = 0;\n      \n      for (k = 0; k < 4; ++ k){\n        dx = candidates[i][k].x - candidates[j][k].x;\n        dy = candidates[i][k].y - candidates[j][k].y;\n      \n        dist += dx * dx + dy * dy;\n      }\n      \n      if ( (dist / 4) < (minDist * minDist) ){\n      \n        if ( CV.perimeter( candidates[i] ) < CV.perimeter( candidates[j] ) ){\n          candidates[i].tooNear = true;\n        }else{\n          candidates[j].tooNear = true;\n        }\n      }\n    }\n  }\n\n  for (i = 0; i < len; ++ i){\n    if ( !candidates[i].tooNear ){\n      notTooNear.push( candidates[i] );\n    }\n  }\n\n  return notTooNear;\n};\n\nAR.Detector.prototype.findMarkers = function(imageSrc, candidates, warpSize){\n  var markers = [], len = candidates.length, candidate, marker, i;\n\n  for (i = 0; i < len; ++ i){\n    candidate = candidates[i];\n\n    CV.warp(imageSrc, this.homography, candidate, warpSize);\n  \n    CV.threshold(this.homography, this.homography, CV.otsu(this.homography) );\n\n    marker = this.getMarker(this.homography, candidate);\n    if (marker){\n      markers.push(marker);\n    }\n  }\n  \n  return markers;\n};\n\nAR.Detector.prototype.getMarker = function(imageSrc, candidate){\n  var width = (imageSrc.width / 7) >>> 0,\n      minZero = (width * width) >> 1,\n      bits = [], rotations = [], distances = [],\n      square, pair, inc, i, j;\n\n  for (i = 0; i < 7; ++ i){\n    inc = (0 === i || 6 === i)? 1: 6;\n    \n    for (j = 0; j < 7; j += inc){\n      square = {x: j * width, y: i * width, width: width, height: width};\n      if ( CV.countNonZero(imageSrc, square) > minZero){\n        return null;\n      }\n    }\n  }\n\n  for (i = 0; i < 5; ++ i){\n    bits[i] = [];\n\n    for (j = 0; j < 5; ++ j){\n      square = {x: (j + 1) * width, y: (i + 1) * width, width: width, height: width};\n      \n      bits[i][j] = CV.countNonZero(imageSrc, square) > minZero? 1: 0;\n    }\n  }\n\n  rotations[0] = bits;\n  distances[0] = this.hammingDistance( rotations[0] );\n  \n  pair = {first: distances[0], second: 0};\n  \n  for (i = 1; i < 4; ++ i){\n    rotations[i] = this.rotate( rotations[i - 1] );\n    distances[i] = this.hammingDistance( rotations[i] );\n    \n    if (distances[i] < pair.first){\n      pair.first = distances[i];\n      pair.second = i;\n    }\n  }\n\n  if (0 !== pair.first){\n    return null;\n  }\n\n  return AR.Marker(\n    this.mat2id(rotations[pair.second]), \n    this.rotate2(candidate, 4 - pair.second)\n  );\n};\n\nAR.Detector.prototype.hammingDistance = function(bits){\n  var ids = [ [1,0,0,0,0], [1,0,1,1,1], [0,1,0,0,1], [0,1,1,1,0] ],\n      dist = 0, sum, minSum, i, j, k;\n\n  for (i = 0; i < 5; ++ i){\n    minSum = Infinity;\n    \n    for (j = 0; j < 4; ++ j){\n      sum = 0;\n\n      for (k = 0; k < 5; ++ k){\n          sum += bits[i][k] === ids[j][k]? 0: 1;\n      }\n\n      if (sum < minSum){\n        minSum = sum;\n      }\n    }\n\n    dist += minSum;\n  }\n\n  return dist;\n};\n\nAR.Detector.prototype.mat2id = function(bits){\n  var id = 0, i;\n  \n  for (i = 0; i < 5; ++ i){\n    id <<= 1;\n    id |= bits[i][1];\n    id <<= 1;\n    id |= bits[i][3];\n  }\n\n  return id;\n};\n\nAR.Detector.prototype.rotate = function(src){\n  var dst = [], len = src.length, i, j;\n  \n  for (i = 0; i < len; ++ i){\n    dst[i] = [];\n    for (j = 0; j < src[i].length; ++ j){\n      dst[i][j] = src[src[i].length - j - 1][i];\n    }\n  }\n\n  return dst;\n};\n\nAR.Detector.prototype.rotate2 = function(src, rotation){\n  var dst = [], len = src.length, i;\n  \n  for (i = 0; i < len; ++ i){\n    dst[i] = src[ (rotation + i) % len ];\n  }\n\n  return dst;\n};\n\n\nconst DEFAULT_DEFECTION_PARAMS = {\n\n};\n\nclass ArucoDetector {\n  constructor() {\n    this.grey = new CV.Image();\n    this.thres = new CV.Image();\n    this.homography = new CV.Image();\n    this.binary = [];\n    this.contours = [];\n    this.polys = [];\n    this.candidates = [];\n\n    this.detectionParams = {\n      ...DEFAULT_DEFECTION_PARAMS,\n      ...newParams,\n    };\n  }\n\n  updateParams(newParams) {\n    this.detectionParams = {\n      ...this.detectionParams,\n      ...newParams,\n    };\n  }\n}\n\nexport default AR;\n","import aruco from './aruco/index.js';\nimport AR from './aruco/index.js';\n\nlet canStreamMarkers = false;\n\nconst MESSAGE_TYPES = {\n  SET_HOST: 'SET_HOST',\n  MARKER_DATA: 'MARKER_DATA',\n  VIDEO_DATA: 'VIDEO_DATA',\n  SET_CAMERA_PARAMS: 'SET_CAMERA_PARAMS',\n  CONNECT_TO_HOST: 'CONNECT_TO_HOST',\n};\n\nlet peerID;\nlet shouldStreamVideo = false;\n\nconst socket = new WebSocket('wss://beholder-server.herokuapp.com');\nlet canStream = false;\n\nconst params = (new URL(document.location)).searchParams;\nconst hostID = params.get('host');\nconst observerID = params.get('observerID');\nlet fpsCounter;\n\n// Connection opened\nsocket.addEventListener('open', function (event) {\n  canStreamMarkers = true;\n\n  // console.log(hostID, observerID);\n  const msg = {\n    type: MESSAGE_TYPES.CONNECT_TO_HOST,\n    data: {\n      hostID,\n      observerID,\n    },\n  };\n  socket.send(JSON.stringify(msg));\n});\n\n// Listen for messages\nsocket.addEventListener('message', function (event) {\n    const msg = JSON.parse(event.data);\n    // console.log('got some data', msg.type);\n    switch (msg.type) {\n      case MESSAGE_TYPES.SET_CAMERA_PARAMS:\n        AR.setCameraParams(msg.data.params);\n        break;\n      default: break;\n    }\n});\n\n\n\nvar video, canvas, context, imageData, detector, aspectRatio;\nvar overlay, overlayCtx;\n  \nfunction onLoad(){\n  video = document.getElementById(\"video\");\n  canvas = document.getElementById(\"canvas\");\n  context = canvas.getContext(\"2d\");\n  overlay = document.getElementById(\"overlay\");\n  overlayCtx = overlay.getContext(\"2d\");\n  fpsCounter = document.querySelector('#fps');\n\n  canvas.width = window.innerWidth;\n  canvas.height = window.innerHeight;\n\n  if (navigator.mediaDevices === undefined) {\n    navigator.mediaDevices = {};\n  }\n\n  if (navigator.mediaDevices.getUserMedia === undefined) {\n    navigator.mediaDevices.getUserMedia = function(constraints) {\n      var getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;\n\n      if (!getUserMedia) {\n        return Promise.reject(new Error('getUserMedia is not implemented in this browser'));\n      }\n\n      return new Promise(function(resolve, reject) {\n        getUserMedia.call(navigator, constraints, resolve, reject);\n      });\n    }\n  }\n  \n  navigator.mediaDevices\n    .getUserMedia({ video: { width: 480, height: 360, facingMode: \"environment\" } })\n    .then(function(stream) {\n      if (\"srcObject\" in video) {\n        video.srcObject = stream;\n        aspectRatio = stream.getVideoTracks()[0].getSettings().aspectRatio;\n      } else {\n        video.src = window.URL.createObjectURL(stream);\n      }\n    \n    })\n    .catch(function(err) {\n      console.log(err.name + \": \" + err.message);\n    }\n  );\n\n  detector = new aruco.Detector();\n\n  requestAnimationFrame(update);\n}\n\nlet prevTime = Date.now();\nconst FRAME_CAP = 1.0 / 30; // Capped frame rate, 1/30 = 30fps\nlet frameCounter = 0;\n\nfunction update(){\n  const currentTime = Date.now();\n  const dt = currentTime - prevTime;\n  prevTime = currentTime;\n  frameCounter += dt / 1000;\n\n  requestAnimationFrame(update);\n\n  // logic for frame capping for future optimizations\n  // browsers are already capped at 60\n  if (frameCounter >= FRAME_CAP) {\n    fpsCounter.innerHTML = Math.floor(1 / frameCounter);\n    frameCounter = 0;\n\n  } else {\n    return;\n  }\n\n  if (canvas.width !== video.videoWidth) {\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n    overlay.width = video.videoWidth;\n    overlay.height = video.videoHeight;\n  }\n\n  if (video.readyState === video.HAVE_ENOUGH_DATA){\n    // Render video frame\n    context.drawImage(video, 0, 0, canvas.width, canvas.height);\n    imageData = context.getImageData(0, 0, canvas.width, canvas.height);\n    \n    overlayCtx.clearRect(0,0, overlay.width, overlay.height);\n\n    var markers = detector.detect(imageData);\n\n    if (canStreamMarkers) {\n      socket.send(JSON.stringify({\n        type: MESSAGE_TYPES.MARKER_DATA,\n        data: { hostID, observerID, markers },\n      }));\n    }\n  }\n}\n\nfunction drawCorners(ctx, markers){\n  ctx.lineWidth = 3;\n\n  markers.forEach((m) => {\n    const { center, corners } = m;\n\n    ctx.strokeStyle = \"red\";\n    ctx.beginPath();\n\n    corners.forEach((c, i) => {\n      ctx.moveTo(c.x, c.y);\n      c2 = corners[(I + 1) % corners.length];\n      ctx.lineTo(c2.x, c2.y);\n    });\n\n    ctx.stroke();\n    ctx.closePath();\n\n    // draw first corner\n    ctx.strokeStyle = \"green\";\n    ctx.strokeRect(corners[0].x - 2, corners[0].y - 2, 4, 4);\n\n    ctx.strokeStyle = \"yellow\";\n    ctx.strokeRect(center.x - 2, center.y - 2, 4, 4);\n  });\n}\n\nfunction drawId(markers){\n  var corners, corner, x, y, i, j;\n\n  overlayCtx.strokeStyle = \"blue\";\n  overlayCtx.lineWidth = 1;\n\n  for (i = 0; i !== markers.length; ++ i){\n    corners = markers[i].corners;\n\n    x = Infinity;\n    y = Infinity;\n\n    for (j = 0; j !== corners.length; ++ j){\n      corner = corners[j];\n\n      x = Math.min(x, corner.x);\n      y = Math.min(y, corner.y);\n    }\n\n    overlayCtx.strokeText(markers[i].id, x, y)\n  }\n}\n\nwindow.onload = onLoad;\n\n// service worker businus\nif('serviceWorker' in navigator) {\n  // console.log('doin service');\n  navigator.serviceWorker.register('./sw.js');\n};\n"],"sourceRoot":""}